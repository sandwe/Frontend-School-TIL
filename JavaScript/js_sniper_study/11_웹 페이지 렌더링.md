# 웹 페이지 렌더링

> 참고 사이트
>
> https://developer.chrome.com/blog/inside-browser-part1/

## 웹 브라우저의 기본적인 구조

- **사용자 인터페이스**: 웹 브라우저읮 주소창, 뒤로가기, 새로고침 버튼 등
- **브라우저 엔진**: 사용자 인터페이스와 렌더링 엔진을 중개해준다.
- **렌더링 엔진**: HTML, CSS, JavaScript 코드를 사용자에게 렌더링해준다.
  - 코드를 해석하며 다운받을 이미지, 다른 script 등을 **통신**을 통해 다운받는다.
  - JavaScript 코드를 **해석기**를 통해 해석한다.
  - **UI 백엔드**: 브라우저마다 select 버튼이 다른 것철 OS에 의존하는 UI 형태
- 자료 저장소: 쿠키처럼 지속적으로 저장되어야 하는 것들이 저장되는 공간

## 렌더링 엔진이 하는 일

### 1. 파싱

- HTML을 파싱하여 DOM으로 변환하는 과정
- 오타 혹은 잘못된 문법을 사용했을 때 예외처리를 한다.
- `<link>`, `<img>` 태그를 만나면 리소스를 다운받는다.
- `<script>` 태그를 만나면 DOM 파싱을 중단하고 자바스크립트를 해석한다.

❓왜 `<script>` 태그를 만나면 DOM 파싱을 중단할까?

- `<script>` 태그로 연결된 자바스크립트 파일에 DOM 구조를 변환하는 코드가 들어있을 수 있기 때문이다.

```JS
document.write("<h2>hi</h2>");
```

<br>

### 2. 스타일 계산

- CSS를 파싱하여 CSSOM으로 변환한다.
- CSSOM 정보를 통해 돔 노드에 대한 스타일을 결정한다.
  결정된 스타일은 크로 개발자 도구의 Computed 탭에서 확인 가능하다.

<br>

### 3. 레이아웃 트리(렌더트리)를 생성한다.

- 돔과 계산된 스타일을 따락며 요소의 크기나 좌표와 같은 정보를 담은 레이아웃 트리를 생성한다.
- **화면에 표현되는 정보**만 레이아웃 트리에 담게 된다.  
  ➡️ `display: none` 은 트리에 담기지 않는다.  
  ➡️ **가상요소**는 DOM에는 없었지만 CSS로 만들어서 트리에 담긴다.
  ➡️ `visibility: hidden`은 레이아웃은 유지하기 때문에 트리에 담긴다.

<br>

### 4. 페인트

- 레이아웃 트리가 생성되면 이 트리를 따라 페인트 기록이 생성된다.
- 페인트 기록에는 요소를 렌더링하는 순서가 저장된다.
- 그리고 지금까지의 정보를 바탕으로 한 페이지를 여러개의 레이어로 나눈 뒤, 그위에 텍스트, 색, 이미지, 보더, 그림자 등의 모든 시각적 부분을 그리는 작업이 진행된다.

<br>

### 5. 컴포지팅

- 각각의 레이어를 스크린에 픽셀로 표현한다. (레스터링)
- 나누었던 레이어를 합서앻 페이지를 그린다. (컴포지팅)
